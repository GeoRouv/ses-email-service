<div id="activity-table">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recipient</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Opened</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sent</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for msg in activity.messages %}
            <tr class="hover:bg-gray-50 cursor-pointer transition"
                onclick="window.location='/dashboard/activity/{{ msg.id }}'">
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">{{ msg.to_email }}</div>
                    <div class="text-xs text-gray-400">{{ msg.from_email }}</div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-gray-900 truncate max-w-xs">{{ msg.subject }}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if msg.status == 'sent' %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">Sent</span>
                    {% elif msg.status == 'delivered' %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Delivered</span>
                    {% elif msg.status == 'bounced' %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Bounced</span>
                    {% elif msg.status == 'deferred' %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Deferred</span>
                    {% elif msg.status == 'complained' %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">Complained</span>
                    {% elif msg.status == 'rejected' %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-800 text-white">Rejected</span>
                    {% else %}
                        <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600">{{ msg.status }}</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {% if msg.opened_at %}
                        <span class="text-green-600" title="{{ msg.opened_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}">Yes</span>
                    {% else %}
                        <span class="text-gray-400">No</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" title="{{ msg.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}">
                    {{ msg.created_at.strftime('%b %d, %H:%M') }}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                    No messages found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    {% if activity.pages > 1 %}
    <div class="bg-white px-6 py-4 border-t border-gray-200 flex items-center justify-between">
        <div class="text-sm text-gray-500">
            Showing {{ ((activity.page - 1) * activity.per_page) + 1 }}â€“{{ [activity.page * activity.per_page, activity.total] | min }} of {{ activity.total }} messages
        </div>
        <div class="flex space-x-2">
            {% if activity.page > 1 %}
            <button
                hx-get="/dashboard/activity?page={{ activity.page - 1 }}{% if activity.status_filter %}&status={{ activity.status_filter }}{% endif %}"
                hx-target="#activity-table"
                hx-swap="outerHTML"
                class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition">
                Previous
            </button>
            {% endif %}

            {% for p in range(1, activity.pages + 1) %}
                {% if p == activity.page %}
                <span class="px-3 py-1.5 text-sm bg-blue-600 text-white rounded-md">{{ p }}</span>
                {% elif p == 1 or p == activity.pages or (p >= activity.page - 2 and p <= activity.page + 2) %}
                <button
                    hx-get="/dashboard/activity?page={{ p }}{% if activity.status_filter %}&status={{ activity.status_filter }}{% endif %}"
                    hx-target="#activity-table"
                    hx-swap="outerHTML"
                    class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition">
                    {{ p }}
                </button>
                {% elif p == 2 or p == activity.pages - 1 %}
                <span class="px-3 py-1.5 text-sm text-gray-400">...</span>
                {% endif %}
            {% endfor %}

            {% if activity.page < activity.pages %}
            <button
                hx-get="/dashboard/activity?page={{ activity.page + 1 }}{% if activity.status_filter %}&status={{ activity.status_filter }}{% endif %}"
                hx-target="#activity-table"
                hx-swap="outerHTML"
                class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition">
                Next
            </button>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
